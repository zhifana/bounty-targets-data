# .github/workflows/sync.yml
name: Sync Fork

on:
  push: # push 时触发, 主要是为了测试配置有没有问题
  schedule:
    - cron: '*/5 * * * *' # 每3小时触发, 对于一些更新不那么频繁的项目可以设置为每天一次, 低碳一点

jobs:
  repo-sync:
    runs-on: ubuntu-latest
    steps:
      - uses: TG908/fork-sync@v1.6.3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          owner: arkadiyt #
          head: main # fork 的上游仓库 branch
          base: main # 本地仓库 branch

      - name: 获取提交信息
        id: get_commit_messages
        run: |
          COMMIT_MESSAGES=$(git log --pretty=format:"%h - %s" --reverse HEAD..HEAD@{1})
          echo "::set-output name=commit_messages::$COMMIT_MESSAGES"

      - name: 推送更改到 Fork
        run: git push origin main

      - name: 通知 Discord
        if: success()
        run: |
          curl -X POST -H "Content-Type: application/json" \
            -d '{"content":"Fork 同步完成！\n\n更新内容:\n'"${{ steps.get_commit_messages.outputs.commit_messages }}"'"}' \
            ${{ secrets.DISCORD_WEBHOOK_URL }}
